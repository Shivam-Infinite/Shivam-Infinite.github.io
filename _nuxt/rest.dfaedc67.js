import{l as zn}from"./entry.a658f261.js";const D=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,R=Object.keys,q=Array.isArray;function L(n,t){return typeof t!="object"||R(t).forEach(function(r){n[r]=t[r]}),n}typeof Promise>"u"||D.Promise||(D.Promise=Promise);const Me=Object.getPrototypeOf,Yn={}.hasOwnProperty;function z(n,t){return Yn.call(n,t)}function Ke(n,t){typeof t=="function"&&(t=t(Me(n))),(typeof Reflect>"u"?R:Reflect.ownKeys)(t).forEach(r=>{ee(n,r,t[r])})}const yn=Object.defineProperty;function ee(n,t,r,s){yn(n,t,L(r&&z(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},s))}function xe(n){return{from:function(t){return n.prototype=Object.create(t.prototype),ee(n.prototype,"constructor",n),{extend:Ke.bind(null,n.prototype)}}}}const Gn=Object.getOwnPropertyDescriptor;function zt(n,t){let r;return Gn(n,t)||(r=Me(n))&&zt(r,t)}const Hn=[].slice;function at(n,t,r){return Hn.call(n,t,r)}function mn(n,t){return t(n)}function je(n){if(!n)throw new Error("Assertion Failed")}function gn(n){D.setImmediate?setImmediate(n):setTimeout(n,0)}function vn(n,t){return n.reduce((r,s,i)=>{var o=t(s,i);return o&&(r[o[0]]=o[1]),r},{})}function te(n,t){if(z(n,t))return n[t];if(!t)return n;if(typeof t!="string"){for(var r=[],s=0,i=t.length;s<i;++s){var o=te(n,t[s]);r.push(o)}return r}var a=t.indexOf(".");if(a!==-1){var l=n[t.substr(0,a)];return l===void 0?void 0:te(l,t.substr(a+1))}}function Y(n,t,r){if(n&&t!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof t!="string"&&"length"in t){je(typeof r!="string"&&"length"in r);for(var s=0,i=t.length;s<i;++s)Y(n,t[s],r[s])}else{var o=t.indexOf(".");if(o!==-1){var a=t.substr(0,o),l=t.substr(o+1);if(l==="")r===void 0?q(n)&&!isNaN(parseInt(a))?n.splice(a,1):delete n[a]:n[a]=r;else{var u=n[a];u&&z(n,a)||(u=n[a]={}),Y(u,l,r)}}else r===void 0?q(n)&&!isNaN(parseInt(t))?n.splice(t,1):delete n[t]:n[t]=r}}function bn(n){var t={};for(var r in n)z(n,r)&&(t[r]=n[r]);return t}const Qn=[].concat;function _n(n){return Qn.apply([],n)}const wn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(_n([8,16,32,64].map(n=>["Int","Uint","Float"].map(t=>t+n+"Array")))).filter(n=>D[n]),Xn=wn.map(n=>D[n]);vn(wn,n=>[n,!0]);let se=null;function Ve(n){se=typeof WeakMap<"u"&&new WeakMap;const t=kt(n);return se=null,t}function kt(n){if(!n||typeof n!="object")return n;let t=se&&se.get(n);if(t)return t;if(q(n)){t=[],se&&se.set(n,t);for(var r=0,s=n.length;r<s;++r)t.push(kt(n[r]))}else if(Xn.indexOf(n.constructor)>=0)t=n;else{const o=Me(n);for(var i in t=o===Object.prototype?{}:Object.create(o),se&&se.set(n,t),n)z(n,i)&&(t[i]=kt(n[i]))}return t}const{toString:Jn}={};function xt(n){return Jn.call(n).slice(8,-1)}const Et=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Zn=typeof Et=="symbol"?function(n){var t;return n!=null&&(t=n[Et])&&t.apply(n)}:function(){return null},ke={};function J(n){var t,r,s,i;if(arguments.length===1){if(q(n))return n.slice();if(this===ke&&typeof n=="string")return[n];if(i=Zn(n)){for(r=[];!(s=i.next()).done;)r.push(s.value);return r}if(n==null)return[n];if(typeof(t=n.length)=="number"){for(r=new Array(t);t--;)r[t]=n[t];return r}return[n]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const Yt=typeof Symbol<"u"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1;var H=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function kn(n,t){H=n,xn=t}var xn=()=>!0;const er=!new Error("").stack;function ge(){if(er)try{throw ge.arguments,new Error}catch(n){return n}return new Error}function Pt(n,t){var r=n.stack;return r?(t=t||0,r.indexOf(n.name)===0&&(t+=(n.name+n.message).split(`
`).length),r.split(`
`).slice(t).filter(xn).map(s=>`
`+s).join("")):""}var En=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Gt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(En),tr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ee(n,t){this._e=ge(),this.name=n,this.message=t}function Pn(n,t){return n+". Errors: "+Object.keys(t).map(r=>t[r].toString()).filter((r,s,i)=>i.indexOf(r)===s).join(`
`)}function ut(n,t,r,s){this._e=ge(),this.failures=t,this.failedKeys=s,this.successCount=r,this.message=Pn(n,t)}function Ie(n,t){this._e=ge(),this.name="BulkError",this.failures=Object.keys(t).map(r=>t[r]),this.failuresByPos=t,this.message=Pn(n,t)}xe(Ee).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Pt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),xe(ut).from(Ee),xe(Ie).from(Ee);var Ht=Gt.reduce((n,t)=>(n[t]=t+"Error",n),{});const nr=Ee;var S=Gt.reduce((n,t)=>{var r=t+"Error";function s(i,o){this._e=ge(),this.name=r,i?typeof i=="string"?(this.message=`${i}${o?`
 `+o:""}`,this.inner=o||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=tr[t]||r,this.inner=null)}return xe(s).from(nr),n[t]=s,n},{});S.Syntax=SyntaxError,S.Type=TypeError,S.Range=RangeError;var sn=En.reduce((n,t)=>(n[t+"Error"]=S[t],n),{}),et=Gt.reduce((n,t)=>(["Syntax","Type","Range"].indexOf(t)===-1&&(n[t+"Error"]=S[t]),n),{});function C(){}function Ne(n){return n}function rr(n,t){return n==null||n===Ne?t:function(r){return t(n(r))}}function ye(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function sr(n,t){return n===C?t:function(){var r=n.apply(this,arguments);r!==void 0&&(arguments[0]=r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?ye(s,this.onsuccess):s),i&&(this.onerror=this.onerror?ye(i,this.onerror):i),o!==void 0?o:r}}function ir(n,t){return n===C?t:function(){n.apply(this,arguments);var r=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ye(r,this.onsuccess):r),s&&(this.onerror=this.onerror?ye(s,this.onerror):s)}}function or(n,t){return n===C?t:function(r){var s=n.apply(this,arguments);L(r,s);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ye(i,this.onsuccess):i),o&&(this.onerror=this.onerror?ye(o,this.onerror):o),s===void 0?a===void 0?void 0:a:L(s,a)}}function ar(n,t){return n===C?t:function(){return t.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function Qt(n,t){return n===C?t:function(){var r=n.apply(this,arguments);if(r&&typeof r.then=="function"){for(var s=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then(function(){return t.apply(s,o)})}return t.apply(this,arguments)}}et.ModifyError=ut,et.DexieError=Ee,et.BulkError=Ie;var qe={};const[Kt,lt,Ot]=typeof Promise>"u"?[]:(()=>{let n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,Me(n),n];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Me(t),n]})(),Kn=lt&&lt.then,tt=Kt&&Kt.constructor,Xt=!!Ot;var St=!1,ur=Ot?()=>{Ot.then(Ye)}:D.setImmediate?setImmediate.bind(null,Ye):D.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{Ye(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(Ye,0)},Te=function(n,t){De.push([n,t]),ct&&(ur(),ct=!1)},At=!0,ct=!0,de=[],nt=[],Ct=null,jt=Ne,Pe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:an,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{an(n[0],n[1])}catch{}})}},O=Pe,De=[],fe=0,rt=[];function E(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=C,this._lib=!1;var t=this._PSD=O;if(H&&(this._stackHolder=ge(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==qe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&It(this,this._value))}this._state=null,this._value=null,++t.ref,Sn(this,n)}const Dt={get:function(){var n=O,t=ht;function r(s,i){var o=!n.global&&(n!==O||t!==ht);const a=o&&!ne();var l=new E((u,f)=>{Jt(this,new On(dt(s,n,o,a),dt(i,n,o,a),u,f,n))});return H&&jn(l,this),l}return r.prototype=qe,r},set:function(n){ee(this,"then",n&&n.prototype===qe?Dt:{get:function(){return n},set:Dt.set})}};function On(n,t,r,s,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof t=="function"?t:null,this.resolve=r,this.reject=s,this.psd=i}function Sn(n,t){try{t(r=>{if(n._state===null){if(r===n)throw new TypeError("A promise cannot be resolved with itself.");var s=n._lib&&We();r&&typeof r.then=="function"?Sn(n,(i,o)=>{r instanceof E?r._then(i,o):r.then(i,o)}):(n._state=!0,n._value=r,An(n)),s&&ze()}},It.bind(null,n))}catch(r){It(n,r)}}function It(n,t){if(nt.push(t),n._state===null){var r=n._lib&&We();t=jt(t),n._state=!1,n._value=t,H&&t!==null&&typeof t=="object"&&!t._promise&&function(s,i,o){try{s.apply(null,o)}catch(a){i&&i(a)}}(()=>{var s=zt(t,"stack");t._promise=n,ee(t,"stack",{get:()=>St?s&&(s.get?s.get.apply(t):s.value):n.stack})}),function(s){de.some(i=>i._value===s._value)||de.push(s)}(n),An(n),r&&ze()}}function An(n){var t=n._listeners;n._listeners=[];for(var r=0,s=t.length;r<s;++r)Jt(n,t[r]);var i=n._PSD;--i.ref||i.finalize(),fe===0&&(++fe,Te(()=>{--fe==0&&Zt()},[]))}function Jt(n,t){if(n._state!==null){var r=n._state?t.onFulfilled:t.onRejected;if(r===null)return(n._state?t.resolve:t.reject)(n._value);++t.psd.ref,++fe,Te(lr,[r,n,t])}else n._listeners.push(t)}function lr(n,t,r){try{Ct=t;var s,i=t._value;t._state?s=n(i):(nt.length&&(nt=[]),s=n(i),nt.indexOf(i)===-1&&function(o){for(var a=de.length;a;)if(de[--a]._value===o._value)return void de.splice(a,1)}(t)),r.resolve(s)}catch(o){r.reject(o)}finally{Ct=null,--fe==0&&Zt(),--r.psd.ref||r.psd.finalize()}}function Cn(n,t,r){if(t.length===r)return t;var s="";if(n._state===!1){var i,o,a=n._value;a!=null?(i=a.name||"Error",o=a.message||a,s=Pt(a,0)):(i=a,o=""),t.push(i+(o?": "+o:"")+s)}return H&&((s=Pt(n._stackHolder,2))&&t.indexOf(s)===-1&&t.push(s),n._prev&&Cn(n._prev,t,r)),t}function jn(n,t){var r=t?t._numPrev+1:0;r<100&&(n._prev=t,n._numPrev=r)}function Ye(){We()&&ze()}function We(){var n=At;return At=!1,ct=!1,n}function ze(){var n,t,r;do for(;De.length>0;)for(n=De,De=[],r=n.length,t=0;t<r;++t){var s=n[t];s[0].apply(null,s[1])}while(De.length>0);At=!0,ct=!0}function Zt(){var n=de;de=[],n.forEach(s=>{s._PSD.onunhandled.call(null,s._value,s)});for(var t=rt.slice(0),r=t.length;r;)t[--r]()}function Ge(n){return new E(qe,!1,n)}function I(n,t){var r=O;return function(){var s=We(),i=O;try{return oe(r,!0),n.apply(this,arguments)}catch(o){t&&t(o)}finally{oe(i,!1),s&&ze()}}}Ke(E.prototype,{then:Dt,_then:function(n,t){Jt(this,new On(null,null,n,t,O))},catch:function(n){if(arguments.length===1)return this.then(null,n);var t=arguments[0],r=arguments[1];return typeof t=="function"?this.then(null,s=>s instanceof t?r(s):Ge(s)):this.then(null,s=>s&&s.name===t?r(s):Ge(s))},finally:function(n){return this.then(t=>(n(),t),t=>(n(),Ge(t)))},stack:{get:function(){if(this._stack)return this._stack;try{St=!0;var n=Cn(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=n),n}finally{St=!1}}},timeout:function(n,t){return n<1/0?new E((r,s)=>{var i=setTimeout(()=>s(new S.Timeout(t)),n);this.then(r,s).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ee(E.prototype,Symbol.toStringTag,"Dexie.Promise"),Pe.env=Dn(),Ke(E,{all:function(){var n=J.apply(null,arguments).map(He);return new E(function(t,r){n.length===0&&t([]);var s=n.length;n.forEach((i,o)=>E.resolve(i).then(a=>{n[o]=a,--s||t(n)},r))})},resolve:n=>{if(n instanceof E)return n;if(n&&typeof n.then=="function")return new E((r,s)=>{n.then(r,s)});var t=new E(qe,!0,n);return jn(t,Ct),t},reject:Ge,race:function(){var n=J.apply(null,arguments).map(He);return new E((t,r)=>{n.map(s=>E.resolve(s).then(t,r))})},PSD:{get:()=>O,set:n=>O=n},totalEchoes:{get:()=>ht},newPSD:ie,usePSD:Se,scheduler:{get:()=>Te,set:n=>{Te=n}},rejectionMapper:{get:()=>jt,set:n=>{jt=n}},follow:(n,t)=>new E((r,s)=>ie((i,o)=>{var a=O;a.unhandleds=[],a.onunhandled=o,a.finalize=ye(function(){(function(l){function u(){l(),rt.splice(rt.indexOf(u),1)}rt.push(u),++fe,Te(()=>{--fe==0&&Zt()},[])})(()=>{this.unhandleds.length===0?i():o(this.unhandleds[0])})},a.finalize),n()},t,r,s))}),tt&&(tt.allSettled&&ee(E,"allSettled",function(){const n=J.apply(null,arguments).map(He);return new E(t=>{n.length===0&&t([]);let r=n.length;const s=new Array(r);n.forEach((i,o)=>E.resolve(i).then(a=>s[o]={status:"fulfilled",value:a},a=>s[o]={status:"rejected",reason:a}).then(()=>--r||t(s)))})}),tt.any&&typeof AggregateError<"u"&&ee(E,"any",function(){const n=J.apply(null,arguments).map(He);return new E((t,r)=>{n.length===0&&r(new AggregateError([]));let s=n.length;const i=new Array(s);n.forEach((o,a)=>E.resolve(o).then(l=>t(l),l=>{i[a]=l,--s||r(new AggregateError(i))}))})}));const N={awaits:0,echoes:0,id:0};var cr=0,st=[],gt=0,ht=0,hr=0;function ie(n,t,r,s){var i=O,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++hr;var a=Pe.env;o.env=Xt?{Promise:E,PromiseProp:{value:E,configurable:!0,writable:!0},all:E.all,race:E.race,allSettled:E.allSettled,any:E.any,resolve:E.resolve,reject:E.reject,nthen:on(a.nthen,o),gthen:on(a.gthen,o)}:{},t&&L(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=Se(o,n,r,s);return o.ref===0&&o.finalize(),l}function Oe(){return N.id||(N.id=++cr),++N.awaits,N.echoes+=100,N.id}function ne(){return!!N.awaits&&(--N.awaits==0&&(N.id=0),N.echoes=100*N.awaits,!0)}function He(n){return N.echoes&&n&&n.constructor===tt?(Oe(),n.then(t=>(ne(),t),t=>(ne(),F(t)))):n}function dr(n){++ht,N.echoes&&--N.echoes!=0||(N.echoes=N.id=0),st.push(O),oe(n,!0)}function fr(){var n=st[st.length-1];st.pop(),oe(n,!1)}function oe(n,t){var r=O;if((t?!N.echoes||gt++&&n===O:!gt||--gt&&n===O)||In(t?dr.bind(null,n):fr),n!==O&&(O=n,r===Pe&&(Pe.env=Dn()),Xt)){var s=Pe.env.Promise,i=n.env;lt.then=i.nthen,s.prototype.then=i.gthen,(r.global||n.global)&&(Object.defineProperty(D,"Promise",i.PromiseProp),s.all=i.all,s.race=i.race,s.resolve=i.resolve,s.reject=i.reject,i.allSettled&&(s.allSettled=i.allSettled),i.any&&(s.any=i.any))}}function Dn(){var n=D.Promise;return Xt?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(D,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:lt.then,gthen:n.prototype.then}:{}}function Se(n,t,r,s,i){var o=O;try{return oe(n,!0),t(r,s,i)}finally{oe(o,!1)}}function In(n){Kn.call(Kt,n)}function dt(n,t,r,s){return typeof n!="function"?n:function(){var i=O;r&&Oe(),oe(t,!0);try{return n.apply(this,arguments)}finally{oe(i,!1),s&&In(ne)}}}function on(n,t){return function(r,s){return n.call(this,dt(r,t),dt(s,t))}}(""+Kn).indexOf("[native code]")===-1&&(Oe=ne=C);function an(n,t){var r;try{r=t.onuncatched(n)}catch{}if(r!==!1)try{var s,i={promise:t,reason:n};if(D.document&&document.createEvent?((s=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),L(s,i)):D.CustomEvent&&L(s=new CustomEvent("unhandledrejection",{detail:i}),i),s&&D.dispatchEvent&&(dispatchEvent(s),!D.PromiseRejectionEvent&&D.onunhandledrejection))try{D.onunhandledrejection(s)}catch{}H&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch{}}var F=E.reject;function Tt(n,t,r,s){if(n.idbdb&&(n._state.openComplete||O.letThrough||n._vip)){var i=n._createTransaction(t,r,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(o){return o.name===Ht.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Tt(n,t,r,s))):F(o)}return i._promise(t,(o,a)=>ie(()=>(O.trans=i,s(o,a,i)))).then(o=>i._completion.then(()=>o))}if(n._state.openComplete)return F(new S.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return F(new S.DatabaseClosed);n.open().catch(C)}return n._state.dbReadyPromise.then(()=>Tt(n,t,r,s))}const he=String.fromCharCode(65535),Q="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Be=[],yt=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),pr=yt,yr=yt,Tn=n=>!/(dexie\.js|dexie\.min\.js)/.test(n);function me(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}const Bn={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Qe(n){return typeof n!="string"||/\./.test(n)?t=>t:t=>(t[n]===void 0&&n in t&&delete(t=Ve(t))[n],t)}class mr{_trans(t,r,s){const i=this._tx||O.trans,o=this.name;function a(u,f,h){if(!h.schema[o])throw new S.NotFound("Table "+o+" not part of transaction");return r(h.idbtrans,h)}const l=We();try{return i&&i.db===this.db?i===O.trans?i._promise(t,a,s):ie(()=>i._promise(t,a,s),{trans:i,transless:O.transless||O}):Tt(this.db,t,[this.name],a)}finally{l&&ze()}}get(t,r){return t&&t.constructor===Object?this.where(t).first(r):this._trans("readonly",s=>this.core.get({trans:s,key:t}).then(i=>this.hook.reading.fire(i))).then(r)}where(t){if(typeof t=="string")return new this.db.WhereClause(this,t);if(q(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const r=R(t);if(r.length===1)return this.where(r[0]).equals(t[r[0]]);const s=this.schema.indexes.concat(this.schema.primKey).filter(f=>f.compound&&r.every(h=>f.keyPath.indexOf(h)>=0)&&f.keyPath.every(h=>r.indexOf(h)>=0))[0];if(s&&this.db._maxKey!==he)return this.where(s.name).equals(s.keyPath.map(f=>t[f]));!s&&H&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);const{idxByName:i}=this.schema,o=this.db._deps.indexedDB;function a(f,h){try{return o.cmp(f,h)===0}catch{return!1}}const[l,u]=r.reduce(([f,h],d)=>{const c=i[d],p=t[d];return[f||c,f||!c?me(h,c&&c.multi?v=>{const g=te(v,d);return q(g)&&g.some(b=>a(p,b))}:v=>a(p,te(v,d))):h]},[null,null]);return l?this.where(l.name).equals(t[l.keyPath]).filter(u):s?this.filter(u):this.where(r).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,q(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const r=s=>{if(!s)return s;const i=Object.create(t.prototype);for(var o in s)if(z(s,o))try{i[o]=s[o]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t}defineClass(){return this.mapToClass(function(t){L(this,t)})}add(t,r){const{auto:s,keyPath:i}=this.schema.primKey;let o=t;return i&&s&&(o=Qe(i)(t)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"add",keys:r!=null?[r]:null,values:[o]})).then(a=>a.numFailures?E.reject(a.failures[0]):a.lastResult).then(a=>{if(i)try{Y(t,i,a)}catch{}return a})}update(t,r){if(typeof t!="object"||q(t))return this.where(":id").equals(t).modify(r);{const s=te(t,this.schema.primKey.keyPath);if(s===void 0)return F(new S.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?R(r).forEach(i=>{Y(t,i,r[i])}):r(t,{value:t,primKey:s})}catch{}return this.where(":id").equals(s).modify(r)}}put(t,r){const{auto:s,keyPath:i}=this.schema.primKey;let o=t;return i&&s&&(o=Qe(i)(t)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"put",values:[o],keys:r!=null?[r]:null})).then(a=>a.numFailures?E.reject(a.failures[0]):a.lastResult).then(a=>{if(i)try{Y(t,i,a)}catch{}return a})}delete(t){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[t]})).then(r=>r.numFailures?E.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:Bn})).then(t=>t.numFailures?E.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",r=>this.core.getMany({keys:t,trans:r}).then(s=>s.map(i=>this.hook.reading.fire(i))))}bulkAdd(t,r,s){const i=Array.isArray(r)?r:void 0,o=(s=s||(i?void 0:r))?s.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:l,keyPath:u}=this.schema.primKey;if(u&&i)throw new S.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");const f=t.length;let h=u&&l?t.map(Qe(u)):t;return this.core.mutate({trans:a,type:"add",keys:i,values:h,wantResults:o}).then(({numFailures:d,results:c,lastResult:p,failures:v})=>{if(d===0)return o?c:p;throw new Ie(`${this.name}.bulkAdd(): ${d} of ${f} operations failed`,v)})})}bulkPut(t,r,s){const i=Array.isArray(r)?r:void 0,o=(s=s||(i?void 0:r))?s.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:l,keyPath:u}=this.schema.primKey;if(u&&i)throw new S.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new S.InvalidArgument("Arguments objects and keys must have the same length");const f=t.length;let h=u&&l?t.map(Qe(u)):t;return this.core.mutate({trans:a,type:"put",keys:i,values:h,wantResults:o}).then(({numFailures:d,results:c,lastResult:p,failures:v})=>{if(d===0)return o?c:p;throw new Ie(`${this.name}.bulkPut(): ${d} of ${f} operations failed`,v)})})}bulkDelete(t){const r=t.length;return this._trans("readwrite",s=>this.core.mutate({trans:s,type:"delete",keys:t})).then(({numFailures:s,lastResult:i,failures:o})=>{if(s===0)return i;throw new Ie(`${this.name}.bulkDelete(): ${s} of ${r} operations failed`,o)})}}function Re(n){var t={},r=function(l,u){if(u){for(var f=arguments.length,h=new Array(f-1);--f;)h[f-1]=arguments[f];return t[l].subscribe.apply(null,h),n}if(typeof l=="string")return t[l]};r.addEventType=o;for(var s=1,i=arguments.length;s<i;++s)o(arguments[s]);return r;function o(l,u,f){if(typeof l=="object")return a(l);u||(u=ar),f||(f=C);var h={subscribers:[],fire:f,subscribe:function(d){h.subscribers.indexOf(d)===-1&&(h.subscribers.push(d),h.fire=u(h.fire,d))},unsubscribe:function(d){h.subscribers=h.subscribers.filter(function(c){return c!==d}),h.fire=h.subscribers.reduce(u,f)}};return t[l]=r[l]=h,h}function a(l){R(l).forEach(function(u){var f=l[u];if(q(f))o(u,l[u][0],l[u][1]);else{if(f!=="asap")throw new S.InvalidArgument("Invalid event config");var h=o(u,Ne,function(){for(var d=arguments.length,c=new Array(d);d--;)c[d]=arguments[d];h.subscribers.forEach(function(p){gn(function(){p.apply(null,c)})})})}})}}function Ce(n,t){return xe(t).from({prototype:n}),t}function _e(n,t){return!(n.filter||n.algorithm||n.or)&&(t?n.justLimit:!n.replayFilter)}function vt(n,t){n.filter=me(n.filter,t)}function bt(n,t,r){var s=n.replayFilter;n.replayFilter=s?()=>me(s(),t()):t,n.justLimit=r&&!s}function it(n,t){if(n.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(n.index);if(!r)throw new S.Schema("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return r}function un(n,t,r){const s=it(n,t.schema);return t.openCursor({trans:r,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:s,range:n.range}})}function Xe(n,t,r,s){const i=n.replayFilter?me(n.filter,n.replayFilter()):n.filter;if(n.or){const o={},a=(l,u,f)=>{if(!i||i(u,f,c=>u.stop(c),c=>u.fail(c))){var h=u.primaryKey,d=""+h;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(h)),z(o,d)||(o[d]=!0,t(l,u,f))}};return Promise.all([n.or._iterate(a,r),ln(un(n,s,r),n.algorithm,a,!n.keysOnly&&n.valueMapper)])}return ln(un(n,s,r),me(n.algorithm,i),t,!n.keysOnly&&n.valueMapper)}function ln(n,t,r,s){var i=I(s?(o,a,l)=>r(s(o),a,l):r);return n.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();t&&!t(o,l=>a=l,l=>{o.stop(l),a=C},l=>{o.fail(l),a=C})||i(o.value,o,l=>a=l),a()})})}function U(n,t){try{const r=cn(n),s=cn(t);if(r!==s)return r==="Array"?1:s==="Array"?-1:r==="binary"?1:s==="binary"?-1:r==="string"?1:s==="string"?-1:r==="Date"?1:s!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return n>t?1:n<t?-1:0;case"binary":return function(i,o){const a=i.length,l=o.length,u=a<l?a:l;for(let f=0;f<u;++f)if(i[f]!==o[f])return i[f]<o[f]?-1:1;return a===l?0:a<l?-1:1}(hn(n),hn(t));case"Array":return function(i,o){const a=i.length,l=o.length,u=a<l?a:l;for(let f=0;f<u;++f){const h=U(i[f],o[f]);if(h!==0)return h}return a===l?0:a<l?-1:1}(n,t)}}catch{}return NaN}function cn(n){const t=typeof n;if(t!=="object")return t;if(ArrayBuffer.isView(n))return"binary";const r=xt(n);return r==="ArrayBuffer"?"binary":r}function hn(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}class gr{_read(t,r){var s=this._ctx;return s.error?s.table._trans(null,F.bind(null,s.error)):s.table._trans("readonly",t).then(r)}_write(t){var r=this._ctx;return r.error?r.table._trans(null,F.bind(null,r.error)):r.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var r=this._ctx;r.algorithm=me(r.algorithm,t)}_iterate(t,r){return Xe(this._ctx,t,r,this._ctx.table.core)}clone(t){var r=Object.create(this.constructor.prototype),s=Object.create(this._ctx);return t&&L(s,t),r._ctx=s,r}raw(){return this._ctx.valueMapper=null,this}each(t){var r=this._ctx;return this._read(s=>Xe(r,t,s,r.table.core))}count(t){return this._read(r=>{const s=this._ctx,i=s.table.core;if(_e(s,!0))return i.count({trans:r,query:{index:it(s,i.schema),range:s.range}}).then(a=>Math.min(a,s.limit));var o=0;return Xe(s,()=>(++o,!1),r,i).then(()=>o)}).then(t)}sortBy(t,r){const s=t.split(".").reverse(),i=s[0],o=s.length-1;function a(f,h){return h?a(f[s[h]],h-1):f[i]}var l=this._ctx.dir==="next"?1:-1;function u(f,h){var d=a(f,o),c=a(h,o);return d<c?-l:d>c?l:0}return this.toArray(function(f){return f.sort(u)}).then(r)}toArray(t){return this._read(r=>{var s=this._ctx;if(s.dir==="next"&&_e(s,!0)&&s.limit>0){const{valueMapper:i}=s,o=it(s,s.table.core.schema);return s.table.core.query({trans:r,limit:s.limit,values:!0,query:{index:o,range:s.range}}).then(({result:a})=>i?a.map(i):a)}{const i=[];return Xe(s,o=>i.push(o),r,s.table.core).then(()=>i)}},t)}offset(t){var r=this._ctx;return t<=0||(r.offset+=t,_e(r)?bt(r,()=>{var s=t;return(i,o)=>s===0||(s===1?(--s,!1):(o(()=>{i.advance(s),s=0}),!1))}):bt(r,()=>{var s=t;return()=>--s<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),bt(this._ctx,()=>{var r=t;return function(s,i,o){return--r<=0&&i(o),r>=0}},!0),this}until(t,r){return vt(this._ctx,function(s,i,o){return!t(s.value)||(i(o),r)}),this}first(t){return this.limit(1).toArray(function(r){return r[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){var r,s;return vt(this._ctx,function(i){return t(i.value)}),r=this._ctx,s=t,r.isMatch=me(r.isMatch,s),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(s,i){t(i.key,i)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(s,i){t(i.primaryKey,i)})}keys(t){var r=this._ctx;r.keysOnly=!r.isMatch;var s=[];return this.each(function(i,o){s.push(o.key)}).then(function(){return s}).then(t)}primaryKeys(t){var r=this._ctx;if(r.dir==="next"&&_e(r,!0)&&r.limit>0)return this._read(i=>{var o=it(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(({result:i})=>i).then(t);r.keysOnly=!r.isMatch;var s=[];return this.each(function(i,o){s.push(o.primaryKey)}).then(function(){return s}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(r){return r[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,r=t.index&&t.table.schema.idxByName[t.index];if(!r||!r.multi)return this;var s={};return vt(this._ctx,function(i){var o=i.primaryKey.toString(),a=z(s,o);return s[o]=!0,!a}),this}modify(t){var r=this._ctx;return this._write(s=>{var i;if(typeof t=="function")i=t;else{var o=R(t),a=o.length;i=function(g){for(var b=!1,m=0;m<a;++m){var y=o[m],w=t[y];te(g,y)!==w&&(Y(g,y,w),b=!0)}return b}}const l=r.table.core,{outbound:u,extractKey:f}=l.schema.primaryKey,h=this.db._options.modifyChunkSize||200,d=[];let c=0;const p=[],v=(g,b)=>{const{failures:m,numFailures:y}=b;c+=g-y;for(let w of R(m))d.push(m[w])};return this.clone().primaryKeys().then(g=>{const b=m=>{const y=Math.min(h,g.length-m);return l.getMany({trans:s,keys:g.slice(m,m+y),cache:"immutable"}).then(w=>{const K=[],x=[],_=u?[]:null,k=[];for(let P=0;P<y;++P){const j=w[P],T={value:Ve(j),primKey:g[m+P]};i.call(T,T.value,T)!==!1&&(T.value==null?k.push(g[m+P]):u||U(f(j),f(T.value))===0?(x.push(T.value),u&&_.push(g[m+P])):(k.push(g[m+P]),K.push(T.value)))}const A=_e(r)&&r.limit===1/0&&(typeof t!="function"||t===_t)&&{index:r.index,range:r.range};return Promise.resolve(K.length>0&&l.mutate({trans:s,type:"add",values:K}).then(P=>{for(let j in P.failures)k.splice(parseInt(j),1);v(K.length,P)})).then(()=>(x.length>0||A&&typeof t=="object")&&l.mutate({trans:s,type:"put",keys:_,values:x,criteria:A,changeSpec:typeof t!="function"&&t}).then(P=>v(x.length,P))).then(()=>(k.length>0||A&&t===_t)&&l.mutate({trans:s,type:"delete",keys:k,criteria:A}).then(P=>v(k.length,P))).then(()=>g.length>m+y&&b(m+h))})};return b(0).then(()=>{if(d.length>0)throw new ut("Error modifying one or more objects",d,c,p);return g.length})})})}delete(){var t=this._ctx,r=t.range;return _e(t)&&(t.isPrimKey&&!yr||r.type===3)?this._write(s=>{const{primaryKey:i}=t.table.core.schema,o=r;return t.table.core.count({trans:s,query:{index:i,range:o}}).then(a=>t.table.core.mutate({trans:s,type:"deleteRange",range:o}).then(({failures:l,lastResult:u,results:f,numFailures:h})=>{if(h)throw new ut("Could not delete some values",Object.keys(l).map(d=>l[d]),a-h);return a-h}))}):this.modify(_t)}}const _t=(n,t)=>t.value=null;function vr(n,t){return n<t?-1:n===t?0:1}function br(n,t){return n>t?-1:n===t?0:1}function W(n,t,r){var s=n instanceof Fn?new n.Collection(n):n;return s._ctx.error=r?new r(t):new TypeError(t),s}function we(n){return new n.Collection(n,()=>Rn("")).limit(0)}function _r(n,t,r,s,i,o){for(var a=Math.min(n.length,s.length),l=-1,u=0;u<a;++u){var f=t[u];if(f!==s[u])return i(n[u],r[u])<0?n.substr(0,u)+r[u]+r.substr(u+1):i(n[u],s[u])<0?n.substr(0,u)+s[u]+r.substr(u+1):l>=0?n.substr(0,l)+t[l]+r.substr(l+1):null;i(n[u],f)<0&&(l=u)}return a<s.length&&o==="next"?n+r.substr(n.length):a<n.length&&o==="prev"?n.substr(0,r.length):l<0?null:n.substr(0,l)+s[l]+r.substr(l+1)}function Je(n,t,r,s){var i,o,a,l,u,f,h,d=r.length;if(!r.every(g=>typeof g=="string"))return W(n,"String expected.");function c(g){i=function(m){return m==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(g),o=function(m){return m==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(g),a=g==="next"?vr:br;var b=r.map(function(m){return{lower:o(m),upper:i(m)}}).sort(function(m,y){return a(m.lower,y.lower)});l=b.map(function(m){return m.upper}),u=b.map(function(m){return m.lower}),f=g,h=g==="next"?"":s}c("next");var p=new n.Collection(n,()=>re(l[0],u[d-1]+s));p._ondirectionchange=function(g){c(g)};var v=0;return p._addAlgorithm(function(g,b,m){var y=g.key;if(typeof y!="string")return!1;var w=o(y);if(t(w,u,v))return!0;for(var K=null,x=v;x<d;++x){var _=_r(y,w,l[x],u[x],a,f);_===null&&K===null?v=x+1:(K===null||a(K,_)>0)&&(K=_)}return b(K!==null?function(){g.continue(K+h)}:m),!1}),p}function re(n,t,r,s){return{type:2,lower:n,upper:t,lowerOpen:r,upperOpen:s}}function Rn(n){return{type:1,lower:n,upper:n}}class Fn{get Collection(){return this._ctx.table.db.Collection}between(t,r,s,i){s=s!==!1,i=i===!0;try{return this._cmp(t,r)>0||this._cmp(t,r)===0&&(s||i)&&(!s||!i)?we(this):new this.Collection(this,()=>re(t,r,!s,!i))}catch{return W(this,Q)}}equals(t){return t==null?W(this,Q):new this.Collection(this,()=>Rn(t))}above(t){return t==null?W(this,Q):new this.Collection(this,()=>re(t,void 0,!0))}aboveOrEqual(t){return t==null?W(this,Q):new this.Collection(this,()=>re(t,void 0,!1))}below(t){return t==null?W(this,Q):new this.Collection(this,()=>re(void 0,t,!1,!0))}belowOrEqual(t){return t==null?W(this,Q):new this.Collection(this,()=>re(void 0,t))}startsWith(t){return typeof t!="string"?W(this,"String expected."):this.between(t,t+he,!0,!0)}startsWithIgnoreCase(t){return t===""?this.startsWith(t):Je(this,(r,s)=>r.indexOf(s[0])===0,[t],he)}equalsIgnoreCase(t){return Je(this,(r,s)=>r===s[0],[t],"")}anyOfIgnoreCase(){var t=J.apply(ke,arguments);return t.length===0?we(this):Je(this,(r,s)=>s.indexOf(r)!==-1,t,"")}startsWithAnyOfIgnoreCase(){var t=J.apply(ke,arguments);return t.length===0?we(this):Je(this,(r,s)=>s.some(i=>r.indexOf(i)===0),t,he)}anyOf(){const t=J.apply(ke,arguments);let r=this._cmp;try{t.sort(r)}catch{return W(this,Q)}if(t.length===0)return we(this);const s=new this.Collection(this,()=>re(t[0],t[t.length-1]));s._ondirectionchange=o=>{r=o==="next"?this._ascending:this._descending,t.sort(r)};let i=0;return s._addAlgorithm((o,a,l)=>{const u=o.key;for(;r(u,t[i])>0;)if(++i,i===t.length)return a(l),!1;return r(u,t[i])===0||(a(()=>{o.continue(t[i])}),!1)}),s}notEqual(t){return this.inAnyRange([[-(1/0),t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=J.apply(ke,arguments);if(t.length===0)return new this.Collection(this);try{t.sort(this._ascending)}catch{return W(this,Q)}const r=t.reduce((s,i)=>s?s.concat([[s[s.length-1][1],i]]):[[-(1/0),i]],null);return r.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,r){const s=this._cmp,i=this._ascending,o=this._descending,a=this._min,l=this._max;if(t.length===0)return we(this);if(!t.every(y=>y[0]!==void 0&&y[1]!==void 0&&i(y[0],y[1])<=0))return W(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",S.InvalidArgument);const u=!r||r.includeLowers!==!1,f=r&&r.includeUppers===!0;let h,d=i;function c(y,w){return d(y[0],w[0])}try{h=t.reduce(function(y,w){let K=0,x=y.length;for(;K<x;++K){const _=y[K];if(s(w[0],_[1])<0&&s(w[1],_[0])>0){_[0]=a(_[0],w[0]),_[1]=l(_[1],w[1]);break}}return K===x&&y.push(w),y},[]),h.sort(c)}catch{return W(this,Q)}let p=0;const v=f?y=>i(y,h[p][1])>0:y=>i(y,h[p][1])>=0,g=u?y=>o(y,h[p][0])>0:y=>o(y,h[p][0])>=0;let b=v;const m=new this.Collection(this,()=>re(h[0][0],h[h.length-1][1],!u,!f));return m._ondirectionchange=y=>{y==="next"?(b=v,d=i):(b=g,d=o),h.sort(c)},m._addAlgorithm((y,w,K)=>{for(var x=y.key;b(x);)if(++p,p===h.length)return w(K),!1;return!!function(_){return!v(_)&&!g(_)}(x)||(this._cmp(x,h[p][1])===0||this._cmp(x,h[p][0])===0||w(()=>{d===i?y.continue(h[p][0]):y.continue(h[p][1])}),!1)}),m}startsWithAnyOf(){const t=J.apply(ke,arguments);return t.every(r=>typeof r=="string")?t.length===0?we(this):this.inAnyRange(t.map(r=>[r,r+he])):W(this,"startsWithAnyOf() only works with strings")}}function G(n){return I(function(t){return $e(t),n(t.target.error),!1})}function $e(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}const ae=Re(null,"storagemutated");class wr{_lock(){return je(!O.global),++this._reculock,this._reculock!==1||O.global||(O.lockOwnerFor=this),this}_unlock(){if(je(!O.global),--this._reculock==0)for(O.global||(O.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Se(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&O.lockOwnerFor!==this}create(t){if(!this.mode)return this;const r=this.db.idbdb,s=this.db._state.dbOpenError;if(je(!this.idbtrans),!t&&!r)switch(s&&s.name){case"DatabaseClosedError":throw new S.DatabaseClosed(s);case"MissingAPIError":throw new S.MissingAPI(s.message,s);default:throw new S.OpenFailed(s)}if(!this.active)throw new S.TransactionInactive;return je(this._completion._state===null),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=I(i=>{$e(i),this._reject(t.error)}),t.onabort=I(i=>{$e(i),this.active&&this._reject(new S.Abort(t.error)),this.active=!1,this.on("abort").fire(i)}),t.oncomplete=I(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&ae.storagemutated.fire(t.mutatedParts)}),this}_promise(t,r,s){if(t==="readwrite"&&this.mode!=="readwrite")return F(new S.ReadOnly("Transaction is readonly"));if(!this.active)return F(new S.TransactionInactive);if(this._locked())return new E((o,a)=>{this._blockedFuncs.push([()=>{this._promise(t,r,s).then(o,a)},O])});if(s)return ie(()=>{var o=new E((a,l)=>{this._lock();const u=r(a,l,this);u&&u.then&&u.then(a,l)});return o.finally(()=>this._unlock()),o._lib=!0,o});var i=new E((o,a)=>{var l=r(o,a,this);l&&l.then&&l.then(o,a)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(t){var r=this._root();const s=E.resolve(t);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>s);else{r._waitingFor=s,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function a(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=a)})()}var o=r._waitingFor;return new E((a,l)=>{s.then(u=>r._waitingQueue.push(I(a.bind(null,u))),u=>r._waitingQueue.push(I(l.bind(null,u)))).finally(()=>{r._waitingFor===o&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new S.Abort))}table(t){const r=this._memoizedTables||(this._memoizedTables={});if(z(r,t))return r[t];const s=this.schema[t];if(!s)throw new S.NotFound("Table "+t+" not part of transaction");const i=new this.db.Table(t,s,this);return i.core=this.db.core.table(t),r[t]=i,i}}function Bt(n,t,r,s,i,o,a){return{name:n,keyPath:t,unique:r,multi:s,auto:i,compound:o,src:(r&&!a?"&":"")+(s?"*":"")+(i?"++":"")+Mn(t)}}function Mn(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function Nn(n,t,r){return{name:n,primKey:t,indexes:r,mappedClass:null,idxByName:vn(r,s=>[s.name,s])}}let Ue=n=>{try{return n.only([[]]),Ue=()=>[[]],[[]]}catch{return Ue=()=>he,he}};function Rt(n){return n==null?()=>{}:typeof n=="string"?function(t){return t.split(".").length===1?r=>r[t]:r=>te(r,t)}(n):t=>te(t,n)}function dn(n){return[].slice.call(n)}let kr=0;function Fe(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function xr(n,t,r){function s(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:f,upper:h,lowerOpen:d,upperOpen:c}=u;return f===void 0?h===void 0?null:t.upperBound(h,!!c):h===void 0?t.lowerBound(f,!!d):t.bound(f,h,!!d,!!c)}const{schema:i,hasGetAll:o}=function(u,f){const h=dn(u.objectStoreNames);return{schema:{name:u.name,tables:h.map(d=>f.objectStore(d)).map(d=>{const{keyPath:c,autoIncrement:p}=d,v=q(c),g=c==null,b={},m={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:g,compound:v,keyPath:c,autoIncrement:p,unique:!0,extractKey:Rt(c)},indexes:dn(d.indexNames).map(y=>d.index(y)).map(y=>{const{name:w,unique:K,multiEntry:x,keyPath:_}=y,k={name:w,compound:q(_),keyPath:_,unique:K,multiEntry:x,extractKey:Rt(_)};return b[Fe(_)]=k,k}),getIndexByKeyPath:y=>b[Fe(y)]};return b[":id"]=m.primaryKey,c!=null&&(b[Fe(c)]=m.primaryKey),m})},hasGetAll:h.length>0&&"getAll"in f.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,r),a=i.tables.map(u=>function(f){const h=f.name;return{name:h,schema:f,mutate:function({trans:d,type:c,keys:p,values:v,range:g}){return new Promise((b,m)=>{b=I(b);const y=d.objectStore(h),w=y.keyPath==null,K=c==="put"||c==="add";if(!K&&c!=="delete"&&c!=="deleteRange")throw new Error("Invalid operation type: "+c);const{length:x}=p||v||{length:1};if(p&&v&&p.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(x===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let _;const k=[],A=[];let P=0;const j=$=>{++P,$e($)};if(c==="deleteRange"){if(g.type===4)return b({numFailures:P,failures:A,results:[],lastResult:void 0});g.type===3?k.push(_=y.clear()):k.push(_=y.delete(s(g)))}else{const[$,M]=K?w?[v,p]:[v,null]:[p,null];if(K)for(let B=0;B<x;++B)k.push(_=M&&M[B]!==void 0?y[c]($[B],M[B]):y[c]($[B])),_.onerror=j;else for(let B=0;B<x;++B)k.push(_=y[c]($[B])),_.onerror=j}const T=$=>{const M=$.target.result;k.forEach((B,ve)=>B.error!=null&&(A[ve]=B.error)),b({numFailures:P,failures:A,results:c==="delete"?p:k.map(B=>B.result),lastResult:M})};_.onerror=$=>{j($),T($)},_.onsuccess=T})},getMany:({trans:d,keys:c})=>new Promise((p,v)=>{p=I(p);const g=d.objectStore(h),b=c.length,m=new Array(b);let y,w=0,K=0;const x=k=>{const A=k.target;m[A._pos]=A.result,++K===w&&p(m)},_=G(v);for(let k=0;k<b;++k)c[k]!=null&&(y=g.get(c[k]),y._pos=k,y.onsuccess=x,y.onerror=_,++w);w===0&&p(m)}),get:({trans:d,key:c})=>new Promise((p,v)=>{p=I(p);const g=d.objectStore(h).get(c);g.onsuccess=b=>p(b.target.result),g.onerror=G(v)}),query:function(d){return c=>new Promise((p,v)=>{p=I(p);const{trans:g,values:b,limit:m,query:y}=c,w=m===1/0?void 0:m,{index:K,range:x}=y,_=g.objectStore(h),k=K.isPrimaryKey?_:_.index(K.name),A=s(x);if(m===0)return p({result:[]});if(d){const P=b?k.getAll(A,w):k.getAllKeys(A,w);P.onsuccess=j=>p({result:j.target.result}),P.onerror=G(v)}else{let P=0;const j=b||!("openKeyCursor"in k)?k.openCursor(A):k.openKeyCursor(A),T=[];j.onsuccess=$=>{const M=j.result;return M?(T.push(b?M.value:M.primaryKey),++P===m?p({result:T}):void M.continue()):p({result:T})},j.onerror=G(v)}})}(o),openCursor:function({trans:d,values:c,query:p,reverse:v,unique:g}){return new Promise((b,m)=>{b=I(b);const{index:y,range:w}=p,K=d.objectStore(h),x=y.isPrimaryKey?K:K.index(y.name),_=v?g?"prevunique":"prev":g?"nextunique":"next",k=c||!("openKeyCursor"in x)?x.openCursor(s(w),_):x.openKeyCursor(s(w),_);k.onerror=G(m),k.onsuccess=I(A=>{const P=k.result;if(!P)return void b(null);P.___id=++kr,P.done=!1;const j=P.continue.bind(P);let T=P.continuePrimaryKey;T&&(T=T.bind(P));const $=P.advance.bind(P),M=()=>{throw new Error("Cursor not stopped")};P.trans=d,P.stop=P.continue=P.continuePrimaryKey=P.advance=()=>{throw new Error("Cursor not started")},P.fail=I(m),P.next=function(){let B=1;return this.start(()=>B--?this.continue():this.stop()).then(()=>this)},P.start=B=>{const ve=new Promise((V,le)=>{V=I(V),k.onerror=G(le),P.fail=le,P.stop=Ae=>{P.stop=P.continue=P.continuePrimaryKey=P.advance=M,V(Ae)}}),be=()=>{if(k.result)try{B()}catch(V){P.fail(V)}else P.done=!0,P.start=()=>{throw new Error("Cursor behind last entry")},P.stop()};return k.onsuccess=I(V=>{k.onsuccess=be,be()}),P.continue=j,P.continuePrimaryKey=T,P.advance=$,be(),ve},b(P)},m)})},count({query:d,trans:c}){const{index:p,range:v}=d;return new Promise((g,b)=>{const m=c.objectStore(h),y=p.isPrimaryKey?m:m.index(p.name),w=s(v),K=w?y.count(w):y.count();K.onsuccess=I(x=>g(x.target.result)),K.onerror=G(b)})}}}(u)),l={};return a.forEach(u=>l[u.name]=u),{stack:"dbcore",transaction:n.transaction.bind(n),table(u){if(!l[u])throw new Error(`Table '${u}' not found`);return l[u]},MIN_KEY:-1/0,MAX_KEY:Ue(t),schema:i}}function Ft({_novip:n},t){const r=t.db,s=function(i,o,{IDBKeyRange:a,indexedDB:l},u){return{dbcore:function(h,d){return d.reduce((c,{create:p})=>({...c,...p(c)}),h)}(xr(o,a,u),i.dbcore)}}(n._middlewares,r,n._deps,t);n.core=s.dbcore,n.tables.forEach(i=>{const o=i.name;n.core.schema.tables.some(a=>a.name===o)&&(i.core=n.core.table(o),n[o]instanceof n.Table&&(n[o].core=i.core))})}function ft({_novip:n},t,r,s){r.forEach(i=>{const o=s[i];t.forEach(a=>{const l=zt(a,i);(!l||"value"in l&&l.value===void 0)&&(a===n.Transaction.prototype||a instanceof n.Transaction?ee(a,i,{get(){return this.table(i)},set(u){yn(this,i,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):a[i]=new n.Table(i,o))})})}function Mt({_novip:n},t){t.forEach(r=>{for(let s in r)r[s]instanceof n.Table&&delete r[s]})}function Er(n,t){return n._cfg.version-t._cfg.version}function Pr(n,t,r,s){const i=n._dbSchema,o=n._createTransaction("readwrite",n._storeNames,i);o.create(r),o._completion.catch(s);const a=o._reject.bind(o),l=O.transless||O;ie(()=>{O.trans=o,O.transless=l,t===0?(R(i).forEach(u=>{wt(r,u,i[u].primKey,i[u].indexes)}),Ft(n,r),E.follow(()=>n.on.populate.fire(o)).catch(a)):function({_novip:u},f,h,d){const c=[],p=u._versions;let v=u._dbSchema=qt(u,u.idbdb,d),g=!1;function b(){return c.length?E.resolve(c.shift()(h.idbtrans)).then(b):E.resolve()}return p.filter(m=>m._cfg.version>=f).forEach(m=>{c.push(()=>{const y=v,w=m._cfg.dbschema;$t(u,y,d),$t(u,w,d),v=u._dbSchema=w;const K=qn(y,w);K.add.forEach(_=>{wt(d,_[0],_[1].primKey,_[1].indexes)}),K.change.forEach(_=>{if(_.recreate)throw new S.Upgrade("Not yet support for changing primary key");{const k=d.objectStore(_.name);_.add.forEach(A=>Nt(k,A)),_.change.forEach(A=>{k.deleteIndex(A.name),Nt(k,A)}),_.del.forEach(A=>k.deleteIndex(A))}});const x=m._cfg.contentUpgrade;if(x&&m._cfg.version>f){Ft(u,d),h._memoizedTables={},g=!0;let _=bn(w);K.del.forEach(j=>{_[j]=y[j]}),Mt(u,[u.Transaction.prototype]),ft(u,[u.Transaction.prototype],R(_),_),h.schema=_;const k=Yt(x);let A;k&&Oe();const P=E.follow(()=>{if(A=x(h),A&&k){var j=ne.bind(null,null);A.then(j,j)}});return A&&typeof A.then=="function"?E.resolve(A):P.then(()=>A)}}),c.push(y=>{(!g||!pr)&&function(w,K){[].slice.call(K.db.objectStoreNames).forEach(x=>w[x]==null&&K.db.deleteObjectStore(x))}(m._cfg.dbschema,y),Mt(u,[u.Transaction.prototype]),ft(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),h.schema=u._dbSchema})}),b().then(()=>{var m,y;y=d,R(m=v).forEach(w=>{y.db.objectStoreNames.contains(w)||wt(y,w,m[w].primKey,m[w].indexes)})})}(n,t,o,r).catch(a)})}function qn(n,t){const r={del:[],add:[],change:[]};let s;for(s in n)t[s]||r.del.push(s);for(s in t){const i=n[s],o=t[s];if(i){const a={name:s,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!yt)a.recreate=!0,r.change.push(a);else{const l=i.idxByName,u=o.idxByName;let f;for(f in l)u[f]||a.del.push(f);for(f in u){const h=l[f],d=u[f];h?h.src!==d.src&&a.change.push(d):a.add.push(d)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([s,o])}return r}function wt(n,t,r,s){const i=n.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return s.forEach(o=>Nt(i,o)),i}function Nt(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function qt(n,t,r){const s={};return at(t.objectStoreNames,0).forEach(i=>{const o=r.objectStore(i);let a=o.keyPath;const l=Bt(Mn(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),u=[];for(let h=0;h<o.indexNames.length;++h){const d=o.index(o.indexNames[h]);a=d.keyPath;var f=Bt(d.name,a,!!d.unique,!!d.multiEntry,!1,a&&typeof a!="string",!1);u.push(f)}s[i]=Nn(i,l,u)}),s}function $t({_novip:n},t,r){const s=r.db.objectStoreNames;for(let i=0;i<s.length;++i){const o=s[i],a=r.objectStore(o);n._hasGetAll="getAll"in a;for(let l=0;l<a.indexNames.length;++l){const u=a.indexNames[l],f=a.index(u).keyPath,h=typeof f=="string"?f:"["+at(f).join("+")+"]";if(t[o]){const d=t[o].idxByName[h];d&&(d.name=u,delete t[o].idxByName[h],t[o].idxByName[u]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&D.WorkerGlobalScope&&D instanceof D.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}class Kr{_parseStoresSpec(t,r){R(t).forEach(s=>{if(t[s]!==null){var i=t[s].split(",").map((a,l)=>{const u=(a=a.trim()).replace(/([&*]|\+\+)/g,""),f=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Bt(u,f||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),q(f),l===0)}),o=i.shift();if(o.multi)throw new S.Schema("Primary key cannot be multi-valued");i.forEach(a=>{if(a.auto)throw new S.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new S.Schema("Index must have a name and cannot be an empty string")}),r[s]=Nn(s,o,i)}})}stores(t){const r=this.db;this._cfg.storesSource=this._cfg.storesSource?L(this._cfg.storesSource,t):t;const s=r._versions,i={};let o={};return s.forEach(a=>{L(i,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(i,o)}),r._dbSchema=o,Mt(r,[r._allTables,r,r.Transaction.prototype]),ft(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],R(o),o),r._storeNames=R(o),this}upgrade(t){return this._cfg.contentUpgrade=Qt(this._cfg.contentUpgrade||C,t),this}}function en(n,t){let r=n._dbNamesDB;return r||(r=n._dbNamesDB=new pe("__dbnames",{addons:[],indexedDB:n,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function tn(n){return n&&typeof n.databases=="function"}function Ut(n){return ie(function(){return O.letThrough=!0,n()})}function Or(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(t){var r=function(){return indexedDB.databases().finally(t)};n=setInterval(r,100),r()}).finally(function(){return clearInterval(n)}):Promise.resolve()}function Sr(n){const t=n._state,{indexedDB:r}=n._deps;if(t.isBeingOpened||n.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?F(t.dbOpenError):n);H&&(t.openCanceller._stackHolder=ge()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const s=t.openCanceller;function i(){if(t.openCanceller!==s)throw new S.DatabaseClosed("db.open() was cancelled")}let o=t.dbReadyResolve,a=null,l=!1;return E.race([s,(typeof navigator>"u"?E.resolve():Or()).then(()=>new E((u,f)=>{if(i(),!r)throw new S.MissingAPI;const h=n.name,d=t.autoSchema?r.open(h):r.open(h,Math.round(10*n.verno));if(!d)throw new S.MissingAPI;d.onerror=G(f),d.onblocked=I(n._fireOnBlocked),d.onupgradeneeded=I(c=>{if(a=d.transaction,t.autoSchema&&!n._options.allowEmptyDB){d.onerror=$e,a.abort(),d.result.close();const v=r.deleteDatabase(h);v.onsuccess=v.onerror=I(()=>{f(new S.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{a.onerror=G(f);var p=c.oldVersion>Math.pow(2,62)?0:c.oldVersion;l=p<1,n._novip.idbdb=d.result,Pr(n,p/10,a,f)}},f),d.onsuccess=I(()=>{a=null;const c=n._novip.idbdb=d.result,p=at(c.objectStoreNames);if(p.length>0)try{const g=c.transaction((v=p).length===1?v[0]:v,"readonly");t.autoSchema?function({_novip:b},m,y){b.verno=m.version/10;const w=b._dbSchema=qt(0,m,y);b._storeNames=at(m.objectStoreNames,0),ft(b,[b._allTables],R(w),w)}(n,c,g):($t(n,n._dbSchema,g),function(b,m){const y=qn(qt(0,b.idbdb,m),b._dbSchema);return!(y.add.length||y.change.some(w=>w.add.length||w.change.length))}(n,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ft(n,g)}catch{}var v;Be.push(n),c.onversionchange=I(g=>{t.vcFired=!0,n.on("versionchange").fire(g)}),c.onclose=I(g=>{n.on("close").fire(g)}),l&&function({indexedDB:g,IDBKeyRange:b},m){!tn(g)&&m!=="__dbnames"&&en(g,b).put({name:m}).catch(C)}(n._deps,h),u()},f)}))]).then(()=>(i(),t.onReadyBeingFired=[],E.resolve(Ut(()=>n.on.ready.fire(n.vip))).then(function u(){if(t.onReadyBeingFired.length>0){let f=t.onReadyBeingFired.reduce(Qt,C);return t.onReadyBeingFired=[],E.resolve(Ut(()=>f(n.vip))).then(u)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>n).catch(u=>{t.dbOpenError=u;try{a&&a.abort()}catch{}return s===t.openCanceller&&n._close(),F(u)}).finally(()=>{t.openComplete=!0,o()})}function Lt(n){var t=o=>n.next(o),r=i(t),s=i(o=>n.throw(o));function i(o){return a=>{var l=o(a),u=l.value;return l.done?u:u&&typeof u.then=="function"?u.then(r,s):q(u)?Promise.all(u).then(r,s):r(u)}}return i(t)()}function Ar(n,t,r){var s=arguments.length;if(s<2)throw new S.InvalidArgument("Too few arguments");for(var i=new Array(s-1);--s;)i[s-1]=arguments[s];r=i.pop();var o=_n(i);return[n,o,r]}function $n(n,t,r,s,i){return E.resolve().then(()=>{const o=O.transless||O,a=n._createTransaction(t,r,n._dbSchema,s),l={trans:a,transless:o};if(s)a.idbtrans=s.idbtrans;else try{a.create(),n._state.PR1398_maxLoop=3}catch(d){return d.name===Ht.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>$n(n,t,r,null,i))):F(d)}const u=Yt(i);let f;u&&Oe();const h=E.follow(()=>{if(f=i.call(a,a),f)if(u){var d=ne.bind(null,null);f.then(d,d)}else typeof f.next=="function"&&typeof f.throw=="function"&&(f=Lt(f))},l);return(f&&typeof f.then=="function"?E.resolve(f).then(d=>a.active?d:F(new S.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>f)).then(d=>(s&&a._resolve(),a._completion.then(()=>d))).catch(d=>(a._reject(d),F(d)))})}function Ze(n,t,r){const s=q(n)?n.slice():[n];for(let i=0;i<r;++i)s.push(t);return s}const Cr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return{...n,table(t){const r=n.table(t),{schema:s}=r,i={},o=[];function a(h,d,c){const p=Fe(h),v=i[p]=i[p]||[],g=h==null?0:typeof h=="string"?1:h.length,b=d>0,m={...c,isVirtual:b,keyTail:d,keyLength:g,extractKey:Rt(h),unique:!b&&c.unique};return v.push(m),m.isPrimaryKey||o.push(m),g>1&&a(g===2?h[0]:h.slice(0,g-1),d+1,c),v.sort((y,w)=>y.keyTail-w.keyTail),m}const l=a(s.primaryKey.keyPath,0,s.primaryKey);i[":id"]=[l];for(const h of s.indexes)a(h.keyPath,0,h);function u(h){const d=h.query.index;return d.isVirtual?{...h,query:{index:d,range:(c=h.query.range,p=d.keyTail,{type:c.type===1?2:c.type,lower:Ze(c.lower,c.lowerOpen?n.MAX_KEY:n.MIN_KEY,p),lowerOpen:!0,upper:Ze(c.upper,c.upperOpen?n.MIN_KEY:n.MAX_KEY,p),upperOpen:!0})}}:h;var c,p}return{...r,schema:{...s,primaryKey:l,indexes:o,getIndexByKeyPath:function(h){const d=i[Fe(h)];return d&&d[0]}},count:h=>r.count(u(h)),query:h=>r.query(u(h)),openCursor(h){const{keyTail:d,isVirtual:c,keyLength:p}=h.query.index;return c?r.openCursor(u(h)).then(v=>v&&function(g){return Object.create(g,{continue:{value:function(m){m!=null?g.continue(Ze(m,h.reverse?n.MAX_KEY:n.MIN_KEY,d)):h.unique?g.continue(g.key.slice(0,p).concat(h.reverse?n.MIN_KEY:n.MAX_KEY,d)):g.continue()}},continuePrimaryKey:{value(m,y){g.continuePrimaryKey(Ze(m,n.MAX_KEY,d),y)}},primaryKey:{get:()=>g.primaryKey},key:{get(){const m=g.key;return p===1?m[0]:m.slice(0,p)}},value:{get:()=>g.value}})}(v)):r.openCursor(h)}}}}}};function nn(n,t,r,s){return r=r||{},s=s||"",R(n).forEach(i=>{if(z(t,i)){var o=n[i],a=t[i];if(typeof o=="object"&&typeof a=="object"&&o&&a){const l=xt(o);l!==xt(a)?r[s+i]=t[i]:l==="Object"?nn(o,a,r,s+i+"."):o!==a&&(r[s+i]=t[i])}else o!==a&&(r[s+i]=t[i])}else r[s+i]=void 0}),R(t).forEach(i=>{z(n,i)||(r[s+i]=t[i])}),r}const jr={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(t){const r=n.table(t),{primaryKey:s}=r.schema;return{...r,mutate(o){const a=O.trans,{deleting:l,creating:u,updating:f}=a.table(t).hook;switch(o.type){case"add":if(u.fire===C)break;return a._promise("readwrite",()=>h(o),!0);case"put":if(u.fire===C&&f.fire===C)break;return a._promise("readwrite",()=>h(o),!0);case"delete":if(l.fire===C)break;return a._promise("readwrite",()=>h(o),!0);case"deleteRange":if(l.fire===C)break;return a._promise("readwrite",()=>function(c){return d(c.trans,c.range,1e4)}(o),!0)}return r.mutate(o);function h(c){const p=O.trans,v=c.keys||function(g,b){return b.type==="delete"?b.keys:b.keys||b.values.map(g.extractKey)}(s,c);if(!v)throw new Error("Keys missing");return(c=c.type==="add"||c.type==="put"?{...c,keys:v}:{...c}).type!=="delete"&&(c.values=[...c.values]),c.keys&&(c.keys=[...c.keys]),function(g,b,m){return b.type==="add"?Promise.resolve([]):g.getMany({trans:b.trans,keys:m,cache:"immutable"})}(r,c,v).then(g=>{const b=v.map((m,y)=>{const w=g[y],K={onerror:null,onsuccess:null};if(c.type==="delete")l.fire.call(K,m,w,p);else if(c.type==="add"||w===void 0){const x=u.fire.call(K,m,c.values[y],p);m==null&&x!=null&&(m=x,c.keys[y]=m,s.outbound||Y(c.values[y],s.keyPath,m))}else{const x=nn(w,c.values[y]),_=f.fire.call(K,x,m,w,p);if(_){const k=c.values[y];Object.keys(_).forEach(A=>{z(k,A)?k[A]=_[A]:Y(k,A,_[A])})}}return K});return r.mutate(c).then(({failures:m,results:y,numFailures:w,lastResult:K})=>{for(let x=0;x<v.length;++x){const _=y?y[x]:v[x],k=b[x];_==null?k.onerror&&k.onerror(m[x]):k.onsuccess&&k.onsuccess(c.type==="put"&&g[x]?c.values[x]:_)}return{failures:m,results:y,numFailures:w,lastResult:K}}).catch(m=>(b.forEach(y=>y.onerror&&y.onerror(m)),Promise.reject(m)))})}function d(c,p,v){return r.query({trans:c,values:!1,query:{index:s,range:p},limit:v}).then(({result:g})=>h({type:"delete",keys:g,trans:c}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):g.length<v?{failures:[],numFailures:0,lastResult:void 0}:d(c,{...p,lower:g[g.length-1],lowerOpen:!0},v)))}}}}})};function Un(n,t,r){try{if(!t||t.keys.length<n.length)return null;const s=[];for(let i=0,o=0;i<t.keys.length&&o<n.length;++i)U(t.keys[i],n[o])===0&&(s.push(r?Ve(t.values[i]):t.values[i]),++o);return s.length===n.length?s:null}catch{return null}}const Dr={stack:"dbcore",level:-1,create:n=>({table:t=>{const r=n.table(t);return{...r,getMany:s=>{if(!s.cache)return r.getMany(s);const i=Un(s.keys,s.trans._cache,s.cache==="clone");return i?E.resolve(i):r.getMany(s).then(o=>(s.trans._cache={keys:s.keys,values:s.cache==="clone"?Ve(o):o},o))},mutate:s=>(s.type!=="add"&&(s.trans._cache=null),r.mutate(s))}}})};function rn(n){return!("from"in n)}const X=function(n,t){if(!this){const r=new X;return n&&"d"in n&&L(r,n),r}L(this,arguments.length?{d:1,from:n,to:arguments.length>1?t:n}:{d:0})};function Le(n,t,r){const s=U(t,r);if(isNaN(s))return;if(s>0)throw RangeError();if(rn(n))return L(n,{from:t,to:r,d:1});const i=n.l,o=n.r;if(U(r,n.from)<0)return i?Le(i,t,r):n.l={from:t,to:r,d:1,l:null,r:null},fn(n);if(U(t,n.to)>0)return o?Le(o,t,r):n.r={from:t,to:r,d:1,l:null,r:null},fn(n);U(t,n.from)<0&&(n.from=t,n.l=null,n.d=o?o.d+1:1),U(r,n.to)>0&&(n.to=r,n.r=null,n.d=n.l?n.l.d+1:1);const a=!n.r;i&&!n.l&&pt(n,i),o&&a&&pt(n,o)}function pt(n,t){rn(t)||function r(s,{from:i,to:o,l:a,r:l}){Le(s,i,o),a&&r(s,a),l&&r(s,l)}(n,t)}function Ir(n,t){const r=Vt(t);let s=r.next();if(s.done)return!1;let i=s.value;const o=Vt(n);let a=o.next(i.from),l=a.value;for(;!s.done&&!a.done;){if(U(l.from,i.to)<=0&&U(l.to,i.from)>=0)return!0;U(i.from,l.from)<0?i=(s=r.next(l.from)).value:l=(a=o.next(i.from)).value}return!1}function Vt(n){let t=rn(n)?null:{s:0,n};return{next(r){const s=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,s)for(;t.n.l&&U(r,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!s||U(r,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function fn(n){var t,r;const s=(((t=n.r)===null||t===void 0?void 0:t.d)||0)-(((r=n.l)===null||r===void 0?void 0:r.d)||0),i=s>1?"r":s<-1?"l":"";if(i){const o=i==="r"?"l":"r",a={...n},l=n[i];n.from=l.from,n.to=l.to,n[i]=l[i],a[i]=l[o],n[o]=a,a.d=pn(a)}n.d=pn(n)}function pn({r:n,l:t}){return(n?t?Math.max(n.d,t.d):n.d:t?t.d:0)+1}Ke(X.prototype,{add(n){return pt(this,n),this},addKey(n){return Le(this,n,n),this},addKeys(n){return n.forEach(t=>Le(this,t,t)),this},[Et](){return Vt(this)}});const Tr={stack:"dbcore",level:0,create:n=>{const t=n.schema.name,r=new X(n.MIN_KEY,n.MAX_KEY);return{...n,table:s=>{const i=n.table(s),{schema:o}=i,{primaryKey:a}=o,{extractKey:l,outbound:u}=a,f={...i,mutate:c=>{const p=c.trans,v=p.mutatedParts||(p.mutatedParts={}),g=_=>{const k=`idb://${t}/${s}/${_}`;return v[k]||(v[k]=new X)},b=g(""),m=g(":dels"),{type:y}=c;let[w,K]=c.type==="deleteRange"?[c.range]:c.type==="delete"?[c.keys]:c.values.length<50?[[],c.values]:[];const x=c.trans._cache;return i.mutate(c).then(_=>{if(q(w)){y!=="delete"&&(w=_.results),b.addKeys(w);const k=Un(w,x);k||y==="add"||m.addKeys(w),(k||K)&&function(A,P,j,T){function $(M){const B=A(M.name||"");function ve(V){return V!=null?M.extractKey(V):null}const be=V=>M.multiEntry&&q(V)?V.forEach(le=>B.addKey(le)):B.addKey(V);(j||T).forEach((V,le)=>{const Ae=j&&ve(j[le]),mt=T&&ve(T[le]);U(Ae,mt)!==0&&(Ae!=null&&be(Ae),mt!=null&&be(mt))})}P.indexes.forEach($)}(g,o,k,K)}else if(w){const k={from:w.lower,to:w.upper};m.add(k),b.add(k)}else b.add(r),m.add(r),o.indexes.forEach(k=>g(k.name).add(r));return _})}},h=({query:{index:c,range:p}})=>{var v,g;return[c,new X((v=p.lower)!==null&&v!==void 0?v:n.MIN_KEY,(g=p.upper)!==null&&g!==void 0?g:n.MAX_KEY)]},d={get:c=>[a,new X(c.key)],getMany:c=>[a,new X().addKeys(c.keys)],count:h,query:h,openCursor:h};return R(d).forEach(c=>{f[c]=function(p){const{subscr:v}=O;if(v){const g=K=>{const x=`idb://${t}/${s}/${K}`;return v[x]||(v[x]=new X)},b=g(""),m=g(":dels"),[y,w]=d[c](p);if(g(y.name||"").add(w),!y.isPrimaryKey){if(c!=="count"){const K=c==="query"&&u&&p.values&&i.query({...p,values:!1});return i[c].apply(this,arguments).then(x=>{if(c==="query"){if(u&&p.values)return K.then(({result:k})=>(b.addKeys(k),x));const _=p.values?x.result.map(l):x.result;p.values?b.addKeys(_):m.addKeys(_)}else if(c==="openCursor"){const _=x,k=p.values;return _&&Object.create(_,{key:{get:()=>(m.addKey(_.primaryKey),_.key)},primaryKey:{get(){const A=_.primaryKey;return m.addKey(A),A}},value:{get:()=>(k&&b.addKey(_.primaryKey),_.value)}})}return x})}m.add(r)}}return i[c].apply(this,arguments)}}),f}}}};class pe{constructor(t,r){this._middlewares={},this.verno=0;const s=pe.dependencies;this._options=r={addons:pe.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};const{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:C,dbReadyPromise:null,cancelOpen:C,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;o.dbReadyPromise=new E(l=>{o.dbReadyResolve=l}),o.openCanceller=new E((l,u)=>{o.cancelOpen=u}),this._state=o,this.name=t,this.on=Re(this,"populate","blocked","versionchange","close",{ready:[Qt,C]}),this.on.ready.subscribe=mn(this.on.ready.subscribe,l=>(u,f)=>{pe.vip(()=>{const h=this._state;if(h.openComplete)h.dbOpenError||E.resolve().then(u),f&&l(u);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(u),f&&l(u);else{l(u);const d=this;f||l(function c(){d.on.ready.unsubscribe(u),d.on.ready.unsubscribe(c)})}})}),this.Collection=(a=this,Ce(gr.prototype,function(l,u){this.db=a;let f=Bn,h=null;if(u)try{f=u()}catch(v){h=v}const d=l._ctx,c=d.table,p=c.hook.reading.fire;this._ctx={table:c,index:d.index,isPrimKey:!d.index||c.schema.primKey.keyPath&&d.index===c.schema.primKey.name,range:f,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:d.or,valueMapper:p!==Ne?p:null}})),this.Table=function(l){return Ce(mr.prototype,function(u,f,h){this.db=l,this._tx=h,this.name=u,this.schema=f,this.hook=l._allTables[u]?l._allTables[u].hook:Re(null,{creating:[sr,C],reading:[rr,Ne],updating:[or,C],deleting:[ir,C]})})}(this),this.Transaction=function(l){return Ce(wr.prototype,function(u,f,h,d,c){this.db=l,this.mode=u,this.storeNames=f,this.schema=h,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=Re(this,"complete","error","abort"),this.parent=c||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new E((p,v)=>{this._resolve=p,this._reject=v}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},p=>{var v=this.active;return this.active=!1,this.on.error.fire(p),this.parent?this.parent._reject(p):v&&this.idbtrans&&this.idbtrans.abort(),F(p)})})}(this),this.Version=function(l){return Ce(Kr.prototype,function(u){this.db=l,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(l){return Ce(Fn.prototype,function(u,f,h){this.db=l,this._ctx={table:u,index:f===":id"?null:f,or:h};const d=l._deps.indexedDB;if(!d)throw new S.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(c,p)=>d.cmp(p,c),this._max=(c,p)=>d.cmp(c,p)>0?c:p,this._min=(c,p)=>d.cmp(c,p)<0?c:p,this._IDBKeyRange=l._deps.IDBKeyRange})}(this),this.on("versionchange",l=>{l.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",l=>{!l.newVersion||l.newVersion<l.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${l.oldVersion/10}`)}),this._maxKey=Ue(r.IDBKeyRange),this._createTransaction=(l,u,f,h)=>new this.Transaction(l,u,f,this._options.chromeTransactionDurability,h),this._fireOnBlocked=l=>{this.on("blocked").fire(l),Be.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(l))},this.use(Cr),this.use(jr),this.use(Tr),this.use(Dr),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(l=>l(this))}version(t){if(isNaN(t)||t<.1)throw new S.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new S.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const r=this._versions;var s=r.filter(i=>i._cfg.version===t)[0];return s||(s=new this.Version(t),r.push(s),r.sort(Er),s.stores({}),this._state.autoSchema=!1,s)}_whenReady(t){return this.idbdb&&(this._state.openComplete||O.letThrough||this._vip)?t():new E((r,s)=>{if(this._state.openComplete)return s(new S.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void s(new S.DatabaseClosed);this.open().catch(C)}this._state.dbReadyPromise.then(r,s)}).then(t)}use({stack:t,create:r,level:s,name:i}){i&&this.unuse({stack:t,name:i});const o=this._middlewares[t]||(this._middlewares[t]=[]);return o.push({stack:t,create:r,level:s??10,name:i}),o.sort((a,l)=>a.level-l.level),this}unuse({stack:t,name:r,create:s}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(i=>s?i.create!==s:!!r&&i.name!==r)),this}open(){return Sr(this)}_close(){const t=this._state,r=Be.indexOf(this);if(r>=0&&Be.splice(r,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new E(s=>{t.dbReadyResolve=s}),t.openCanceller=new E((s,i)=>{t.cancelOpen=i})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new S.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,r=this._state;return new E((s,i)=>{const o=()=>{this.close();var a=this._deps.indexedDB.deleteDatabase(this.name);a.onsuccess=I(()=>{(function({indexedDB:l,IDBKeyRange:u},f){!tn(l)&&f!=="__dbnames"&&en(l,u).delete(f).catch(C)})(this._deps,this.name),s()}),a.onerror=G(i),a.onblocked=this._fireOnBlocked};if(t)throw new S.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const t=this._state.dbOpenError;return t&&t.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return R(this._allTables).map(t=>this._allTables[t])}transaction(){const t=Ar.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,r,s){let i=O.trans;i&&i.db===this&&t.indexOf("!")===-1||(i=null);const o=t.indexOf("?")!==-1;let a,l;t=t.replace("!","").replace("?","");try{if(l=r.map(f=>{var h=f instanceof this.Table?f.name:f;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),t=="r"||t==="readonly")a="readonly";else{if(t!="rw"&&t!="readwrite")throw new S.InvalidArgument("Invalid transaction mode: "+t);a="readwrite"}if(i){if(i.mode==="readonly"&&a==="readwrite"){if(!o)throw new S.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&l.forEach(f=>{if(i&&i.storeNames.indexOf(f)===-1){if(!o)throw new S.SubTransaction("Table "+f+" not included in parent transaction.");i=null}}),o&&i&&!i.active&&(i=null)}}catch(f){return i?i._promise(null,(h,d)=>{d(f)}):F(f)}const u=$n.bind(null,this,a,l,i,s);return i?i._promise(a,u,"lock"):O.trans?Se(O.transless,()=>this._whenReady(u)):this._whenReady(u)}table(t){if(!z(this._allTables,t))throw new S.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Br=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Rr{constructor(t){this._subscribe=t}subscribe(t,r,s){return this._subscribe(t&&typeof t!="function"?t:{next:t,error:r,complete:s})}[Br](){return this}}function Ln(n,t){return R(t).forEach(r=>{pt(n[r]||(n[r]=new X),t[r])}),n}function Fr(n){return new Rr(t=>{const r=Yt(n);let s=!1,i={},o={};const a={get closed(){return s},unsubscribe:()=>{s=!0,ae.storagemutated.unsubscribe(h)}};t.start&&t.start(a);let l=!1,u=!1;function f(){return R(o).some(c=>i[c]&&Ir(i[c],o[c]))}const h=c=>{Ln(i,c),f()&&d()},d=()=>{if(l||s)return;i={};const c={},p=function(v){r&&Oe();const g=()=>ie(n,{subscr:v,trans:null}),b=O.trans?Se(O.transless,g):g();return r&&b.then(ne,ne),b}(c);u||(ae("storagemutated",h),u=!0),l=!0,Promise.resolve(p).then(v=>{l=!1,s||(f()?d():(i={},o=c,t.next&&t.next(v)))},v=>{l=!1,t.error&&t.error(v),a.unsubscribe()})};return d(),a})}let Wt;try{Wt={indexedDB:D.indexedDB||D.mozIndexedDB||D.webkitIndexedDB||D.msIndexedDB,IDBKeyRange:D.IDBKeyRange||D.webkitIDBKeyRange}}catch{Wt={indexedDB:null,IDBKeyRange:null}}const ce=pe;function ot(n){let t=Z;try{Z=!0,ae.storagemutated.fire(n)}finally{Z=t}}Ke(ce,{...et,delete:n=>new ce(n,{addons:[]}).delete(),exists:n=>new ce(n,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(n){try{return function({indexedDB:t,IDBKeyRange:r}){return tn(t)?Promise.resolve(t.databases()).then(s=>s.map(i=>i.name).filter(i=>i!=="__dbnames")):en(t,r).toCollection().primaryKeys()}(ce.dependencies).then(n)}catch{return F(new S.MissingAPI)}},defineClass:()=>function(n){L(this,n)},ignoreTransaction:n=>O.trans?Se(O.transless,n):n(),vip:Ut,async:function(n){return function(){try{var t=Lt(n.apply(this,arguments));return t&&typeof t.then=="function"?t:E.resolve(t)}catch(r){return F(r)}}},spawn:function(n,t,r){try{var s=Lt(n.apply(r,t||[]));return s&&typeof s.then=="function"?s:E.resolve(s)}catch(i){return F(i)}},currentTransaction:{get:()=>O.trans||null},waitFor:function(n,t){const r=E.resolve(typeof n=="function"?ce.ignoreTransaction(n):n).timeout(t||6e4);return O.trans?O.trans.waitFor(r):r},Promise:E,debug:{get:()=>H,set:n=>{kn(n,n==="dexie"?()=>!0:Tn)}},derive:xe,extend:L,props:Ke,override:mn,Events:Re,on:ae,liveQuery:Fr,extendObservabilitySet:Ln,getByKeyPath:te,setByKeyPath:Y,delByKeyPath:function(n,t){typeof t=="string"?Y(n,t,void 0):"length"in t&&[].map.call(t,function(r){Y(n,r,void 0)})},shallowClone:bn,deepClone:Ve,getObjectDiff:nn,cmp:U,asap:gn,minKey:-(1/0),addons:[],connections:Be,errnames:Ht,dependencies:Wt,semVer:"3.2.3",version:"3.2.3".split(".").map(n=>parseInt(n)).reduce((n,t,r)=>n+t/Math.pow(10,2*r))}),ce.maxKey=Ue(ce.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ae("storagemutated",n=>{if(!Z){let t;yt?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,n)):t=new CustomEvent("x-storagemutated-1",{detail:n}),Z=!0,dispatchEvent(t),Z=!1}}),addEventListener("x-storagemutated-1",({detail:n})=>{Z||ot(n)}));let Z=!1;if(typeof BroadcastChannel<"u"){const n=new BroadcastChannel("x-storagemutated-1");typeof n.unref=="function"&&n.unref(),ae("storagemutated",t=>{Z||n.postMessage(t)}),n.onmessage=t=>{t.data&&ot(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ae("storagemutated",t=>{try{Z||(typeof localStorage<"u"&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:"x-storagemutated-1",changedParts:t})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",t=>{if(t.key==="x-storagemutated-1"){const r=JSON.parse(t.newValue);r&&ot(r.changedParts)}});const n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",function({data:t}){t&&t.type==="x-storagemutated-1"&&ot(t.changedParts)})}E.rejectionMapper=function(n,t){if(!n||n instanceof Ee||n instanceof TypeError||n instanceof SyntaxError||!n.name||!sn[n.name])return n;var r=new sn[n.name](t||n.message,n);return"stack"in n&&ee(r,"stack",{get:function(){return this.inner.stack}}),r},kn(H,Tn);const ue=new pe("ApnaSlideshow");ue.version(4).stores({verifytoken:"++tid,email,access_key,role,login_by"});ue.open();ue.open();async function Vr(n,t,r,s){try{return await ue.verifytoken.add({email:n,access_key:t,role:r,login_by:s},(o,a)=>{if(a)return a;if(e)return e})}catch(i){return console.log("error in adding data"),i}}async function Mr(n){try{return await ue.verifytoken.get({tid:n})}catch(t){return console.log("error in retrive data"),t}}async function Nr(){try{const n=await ue.verifytoken.clear();return n===void 0?(console.log(n),!0):!1}catch(n){return console.log("error in delete records"),n}}async function Vn(){try{const{tid:n,role:t,email:r,login_by:s}=await ue.verifytoken.orderBy("tid").last();return console.log(t),n?{tid:n,role:t,email:r,login_by:s}:!1}catch{return console.log("can't found any id"),!1}}async function qr(n){try{const t=await Vn();return await ue.verifytoken.update(t,{access_key:n}).then(s=>!!s)}catch(t){return console.log("error in Update data"),t}}const Wn=" http://103.86.17.58:8000/api/",$r=async(n,t)=>{const{tid:r}=await Vn();if(!(n&&typeof n=="string"))throw new Error("Please provide valid api.");let s=Wn+n;const i={method:"POST"};if(t&&(i.body=JSON.stringify(t),i.headers={"Content-Type":"application/json"}),r&&typeof r=="number"){const a=await Mr(r);if(a&&a.access_key)i.headers?i.headers.authorization=a.access_key:i.headers={authorization:a.access_key};else throw new Error("No access token found!!")}const o=await fetch(s,i);if(o.status==401){console.log("Invalid Tokens");const a=await Nr();return a?(console.log("rest"),zn("/")):(console.error("coudn't logout"),a)}else if(o.status==440){const a=await Ur(i);return a&&await $r(n,t)}else{if(o.ok)return console.log("Done response"),await o.text();{const a=await o.text();throw console.log(a),new Error(a)}}},Ur=async n=>{console.log("Token need regenrate");let r=Wn+"verifyToken";const s=await fetch(r,n);if(console.log("response1",s),s.ok){console.log("201");const i=await qr(await s.text());return console.log(i),i}};export{Vr as A,Mr as a,Nr as d,Vn as g,$r as r};
